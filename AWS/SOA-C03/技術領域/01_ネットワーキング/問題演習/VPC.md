# VPC 問題集

---

## 問題1

ある企業が、複数のAWSアカウントでVPCを運用しています。各VPCは異なるリージョンに配置されており、VPC間でプライベート通信を確立する必要があります。VPCピアリングを使用する場合、以下のうち正しい説明はどれですか？（2つ選択してください）

A. VPCピアリングは推移的であるため、VPC AとVPC Bがピアリング、VPC BとVPC Cがピアリングしている場合、VPC AとVPC Cは自動的に通信可能になる

B. VPCピアリング接続を確立するには、両方のVPCのCIDRブロックが重複していてはいけない

C. 異なるリージョン間でもVPCピアリングは可能である

D. VPCピアリング接続を確立するには、両方のVPCのルートテーブルにルートを追加する必要がある

E. VPCピアリング接続は、同じAWSアカウント内のVPC間でのみ可能である

---

<details>
<summary>解答1を表示</summary>

### 正解

**正解: B, D**

### 解説

**A. 誤り** - VPCピアリングは非推移的です。VPC AとVPC Bがピアリング、VPC BとVPC Cがピアリングしていても、VPC AとVPC Cは直接通信できません。

**B. 正しい** - VPCピアリングを確立するには、両方のVPCのCIDRブロックが重複していてはいけません。重複している場合、ルーティングの競合が発生します。

**C. 正しい** - VPCピアリングは異なるリージョン間でも可能です。ただし、同じリージョン内のピアリングよりもレイテンシが高くなります。

**D. 正しい** - VPCピアリング接続を確立した後、両方のVPCのルートテーブルにピアリング接続へのルートを追加する必要があります。

**E. 誤り** - VPCピアリングは異なるAWSアカウント間でも可能です。

### 参考

- [AWS VPCピアリング公式ドキュメント](https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html)

</details>

---

## 問題2

ある企業が、VPC内にパブリックサブネットとプライベートサブネットを配置しています。プライベートサブネット内のEC2インスタンスがインターネットにアクセスする必要がありますが、インターネットからプライベートサブネット内のインスタンスへの直接アクセスは許可したくありません。

この要件を満たすために、最も適切なソリューションはどれですか？

A. プライベートサブネットにインターネットゲートウェイを配置する

B. パブリックサブネットにNATゲートウェイを配置し、プライベートサブネットのルートテーブルにNATゲートウェイへのルートを追加する

C. プライベートサブネットにNATインスタンスを配置する

D. プライベートサブネットにインターネットゲートウェイを配置し、セキュリティグループでアウトバウンドトラフィックのみを許可する

---

<details>
<summary>解答2を表示</summary>

### 正解

**正解: B**

### 解説

**A. 誤り** - インターネットゲートウェイをプライベートサブネットに配置しても、プライベートサブネット内のインスタンスはインターネットにアクセスできません。また、インターネットゲートウェイはVPCレベルでアタッチするもので、サブネットに配置するものではありません。

**B. 正しい** - NATゲートウェイをパブリックサブネットに配置し、プライベートサブネットのルートテーブルにNATゲートウェイへのルートを追加することで、プライベートサブネット内のインスタンスがインターネットにアウトバウンドアクセスできるようになります。一方、インターネットからプライベートサブネット内のインスタンスへの直接アクセスはできません。

**C. 誤り** - NATインスタンスも使用可能ですが、マネージドサービスであるNATゲートウェイの方が推奨されます。NATインスタンスは自己管理が必要で、可用性も低くなります。

**D. 誤り** - インターネットゲートウェイはVPCレベルでアタッチするもので、サブネットに配置するものではありません。また、セキュリティグループだけでは、プライベートサブネット内のインスタンスがインターネットにアクセスできるようにはなりません。

### 参考

- [AWS NATゲートウェイ公式ドキュメント](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html)

</details>

---

## 問題3

ある企業が、VPC内のEC2インスタンスからS3バケットにアクセスする必要があります。インターネットを経由せずに、プライベートにS3にアクセスしたいと考えています。また、データ転送コストを削減したいと考えています。

この要件を満たすために、最も適切な方法はどれですか？

A. インターネットゲートウェイ経由でS3にアクセスする

B. NATゲートウェイ経由でS3にアクセスする

C. VPCエンドポイント（Gateway Endpoint）を使用してS3にアクセスする

D. VPCエンドポイント（Interface Endpoint）を使用してS3にアクセスする

---

<details>
<summary>解答3を表示</summary>

### 正解

**正解: C**

### 解説

**A. 誤り** - インターネットゲートウェイ経由では、インターネットを経由することになり、プライベート接続にはなりません。また、データ転送コストも発生します。

**B. 誤り** - NATゲートウェイ経由でも、インターネットを経由することになり、プライベート接続にはなりません。また、NATゲートウェイの料金とデータ転送コストも発生します。

**C. 正しい** - VPCエンドポイント（Gateway Endpoint）を使用することで、インターネットを経由せずにプライベートにS3にアクセスできます。また、S3へのデータ転送料金が無料になるため、コストを削減できます。

**D. 誤り** - VPCエンドポイント（Interface Endpoint）も使用可能ですが、S3の場合はGateway Endpointの方が推奨されます。Gateway Endpointは無料で、Interface Endpointは時間単位の料金とデータ転送料金が発生します。

### 参考

- [AWS VPCエンドポイント公式ドキュメント](https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints.html)

</details>

---

