# AWS CloudFrontについて

## 概要

CloudFrontは、AWSのグローバルなコンテンツ配信ネットワーク（CDN）サービスです。CloudFrontを使用することで、コンテンツを世界中のエッジロケーションにキャッシュし、ユーザーに低レイテンシでコンテンツを配信できます。

## CloudFrontの主な特徴

### 1. グローバルなエッジロケーション

#### 概要
CloudFrontは、世界中に数百のエッジロケーションを配置しています。ユーザーに最も近いエッジロケーションからコンテンツを配信します。

#### 特徴
- **低レイテンシ**: ユーザーに最も近いエッジロケーションから配信
- **高可用性**: 複数のエッジロケーションで高可用性を確保
- **自動フェイルオーバー**: エッジロケーションが障害発生時も自動的にフェイルオーバー

---

### 2. コンテンツのキャッシング

#### 概要
CloudFrontは、オリジンサーバーから取得したコンテンツをエッジロケーションにキャッシュします。同じコンテンツへのリクエストは、エッジロケーションから直接配信されます。

#### 特徴
- **キャッシュの有効期限**: TTL（Time To Live）でキャッシュの有効期限を設定
- **キャッシュキー**: URL、クエリ文字列、ヘッダーなどに基づいてキャッシュキーを生成
- **キャッシュの無効化**: 必要に応じてキャッシュを無効化可能

---

### 3. オリジンサーバー

#### オリジンの種類
- **S3バケット**: S3バケットをオリジンとして使用
- **EC2インスタンス**: EC2インスタンスをオリジンとして使用
- **Elastic Load Balancer**: ELBをオリジンとして使用
- **カスタムオリジン**: カスタムHTTP/HTTPSサーバーをオリジンとして使用
- **MediaStore**: MediaStoreをオリジンとして使用
- **MediaPackage**: MediaPackageをオリジンとして使用

---

## CloudFrontの構成要素

### 1. ディストリビューション（Distribution）

#### 概要
ディストリビューションは、CloudFrontの設定単位です。オリジンサーバー、キャッシュ動作、セキュリティ設定などを定義します。

#### ディストリビューションの種類

##### Web Distribution
- **HTTP/HTTPS**: HTTP/HTTPSコンテンツを配信
- **静的コンテンツ**: 静的コンテンツ（HTML、CSS、JavaScript、画像など）を配信
- **動的コンテンツ**: 動的コンテンツも配信可能

##### RTMP Distribution
- **ストリーミング**: RTMPプロトコルを使用したストリーミング配信
- **非推奨**: 現在は非推奨（MediaPackageを推奨）

---

### 2. オリジン（Origin）

#### 概要
オリジンは、CloudFrontがコンテンツを取得する元のサーバーです。

#### オリジンの設定
- **オリジンドメイン**: オリジンサーバーのドメイン名またはIPアドレス
- **オリジンパス**: オリジンサーバーのパス（オプション）
- **オリジンシールド**: オリジンへのリクエストを削減する機能
- **オリジンアクセス制御**: S3バケットへのアクセスを制御

---

### 3. キャッシュ動作（Cache Behavior）

#### 概要
キャッシュ動作は、リクエストに基づいてコンテンツをどのようにキャッシュし、配信するかを定義します。

#### キャッシュ動作の設定
- **パスパターン**: URLパスに基づいてキャッシュ動作を適用
- **オリジン**: 使用するオリジン
- **ビューアープロトコルポリシー**: HTTP、HTTPS、リダイレクトの設定
- **キャッシュキー**: キャッシュキーの生成方法
- **TTL**: キャッシュの有効期限
- **圧縮**: コンテンツの圧縮設定

---

### 4. ビューアー証明書（Viewer Certificate）

#### 概要
ビューアー証明書は、CloudFrontがHTTPSリクエストに使用するSSL/TLS証明書です。

#### 証明書の種類
- **ACM証明書**: AWS Certificate Manager（ACM）で管理する証明書
- **IAM証明書**: IAMで管理する証明書（非推奨）
- **カスタム証明書**: 外部で管理する証明書

---

## CloudFrontの機能

### 1. セキュリティ機能

#### AWS WAF統合
- **Web Application Firewall**: AWS WAFと統合してWebアプリケーションを保護
- **ルール**: WAFルールを適用して悪意のあるトラフィックをブロック

#### オリジンアクセス制御（OAC）
- **S3バケット**: S3バケットへの直接アクセスを制限
- **CloudFront経由**: CloudFront経由でのみアクセス可能

#### 署名付きURL/署名付きCookie
- **アクセス制御**: 特定のユーザーにのみコンテンツへのアクセスを許可
- **有効期限**: アクセスの有効期限を設定

---

### 2. パフォーマンス最適化

#### HTTP/2
- **HTTP/2プロトコル**: HTTP/2プロトコルをサポート
- **パフォーマンス向上**: パフォーマンスを向上

#### 圧縮
- **自動圧縮**: 自動的にコンテンツを圧縮
- **帯域幅削減**: 帯域幅を削減

#### オリジンシールド
- **キャッシュヒット率**: キャッシュヒット率を向上
- **オリジン負荷削減**: オリジンサーバーへの負荷を削減

---

### 3. 動的コンテンツの配信

#### 動的コンテンツの最適化
- **キャッシュの制御**: 動的コンテンツのキャッシュを制御
- **オリジンへの転送**: 動的コンテンツはオリジンに転送

#### Lambda@Edge
- **エッジでの実行**: Lambda関数をエッジロケーションで実行
- **カスタム処理**: リクエスト/レスポンスをカスタマイズ

---

## CloudFrontのベストプラクティス

### 1. キャッシュの最適化

#### 推奨事項
- **適切なTTL**: コンテンツの特性に応じて適切なTTLを設定
- **キャッシュキー**: 不要なパラメータをキャッシュキーから除外
- **キャッシュの無効化**: 必要に応じてキャッシュを無効化

---

### 2. セキュリティの設定

#### 推奨事項
- **HTTPS**: すべてのリクエストをHTTPSにリダイレクト
- **AWS WAF**: AWS WAFを統合してWebアプリケーションを保護
- **オリジンアクセス制御**: S3バケットへの直接アクセスを制限

---

### 3. コスト最適化

#### 推奨事項
- **キャッシュヒット率**: キャッシュヒット率を向上させてオリジンへのリクエストを削減
- **圧縮**: コンテンツを圧縮して帯域幅を削減
- **オリジンシールド**: オリジンシールドを使用してオリジンへの負荷を削減

---

## CloudFrontのコスト

### 1. 料金体系

#### データ転送料金
- **エッジからビューアー**: エッジロケーションからビューアーへのデータ転送料金
- **オリジンからエッジ**: オリジンからエッジロケーションへのデータ転送料金
- **リージョン別**: リージョンによって料金が異なる

#### リクエスト料金
- **HTTPリクエスト**: HTTPリクエストごとの料金
- **HTTPSリクエスト**: HTTPSリクエストごとの料金

---

## 参考資料

- [AWS CloudFront公式ドキュメント](https://docs.aws.amazon.com/cloudfront/)
- [AWS CloudFrontユーザーガイド](https://docs.aws.amazon.com/cloudfront/latest/DeveloperGuide/)
- [AWS CloudFrontベストプラクティス](https://docs.aws.amazon.com/cloudfront/latest/DeveloperGuide/best-practices.html)

