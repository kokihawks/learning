# AWS ECS（Elastic Container Service）について

## 概要

ECS（Elastic Container Service）は、Dockerコンテナを実行するためのマネージドコンテナオーケストレーションサービスです。ECSを使用することで、コンテナアプリケーションを簡単にデプロイ、管理、スケーリングできます。

## ECSの主な特徴

### 1. マネージドサービス

#### インフラ管理不要
- **クラスター管理**: ECSがクラスターを管理
- **コンテナオーケストレーション**: コンテナの配置、スケーリング、ヘルスチェックを自動化
- **高可用性**: 自動的に高可用性が確保

---

### 2. 柔軟性

#### 起動タイプ
- **EC2起動タイプ**: EC2インスタンス上でコンテナを実行
- **Fargate起動タイプ**: サーバーレスでコンテナを実行

---

### 3. 統合

#### AWSサービスとの統合
- **Application Load Balancer**: ALBと統合してロードバランシング
- **CloudWatch**: CloudWatchと統合してモニタリング
- **IAM**: IAMと統合してアクセス制御

---

## ECSの構成要素

### 1. クラスター（Cluster）

#### 概要
クラスターは、コンテナを実行するための論理的なグループです。

#### クラスターの種類
- **EC2クラスター**: EC2インスタンスで構成されるクラスター
- **Fargateクラスター**: Fargateで構成されるクラスター

---

### 2. タスク定義（Task Definition）

#### 概要
タスク定義は、コンテナの実行方法を定義するJSONファイルです。

#### タスク定義の要素
- **コンテナ定義**: コンテナイメージ、CPU、メモリ、環境変数など
- **タスクロール**: タスクがAWSサービスにアクセスするためのIAMロール
- **ネットワークモード**: ネットワークモード（bridge、host、awsvpc、none）
- **ボリューム**: データボリュームの定義

---

### 3. タスク（Task）

#### 概要
タスクは、タスク定義に基づいて実行されるコンテナのインスタンスです。

#### タスクの種類
- **スタンドアロンタスク**: サービスに属さない単発のタスク
- **サービスタスク**: サービスに属するタスク

---

### 4. サービス（Service）

#### 概要
サービスは、指定された数のタスクを実行し、維持するための設定です。

#### サービスの機能
- **タスク数の維持**: 指定された数のタスクを維持
- **自動スケーリング**: 需要に応じて自動的にスケーリング
- **ロードバランシング**: Application Load Balancerと統合
- **ヘルスチェック**: タスクのヘルスを監視

---

## ECSの起動タイプ

### 1. EC2起動タイプ

#### 概要
EC2起動タイプは、EC2インスタンス上でコンテナを実行します。

#### 特徴
- **インスタンス管理**: EC2インスタンスを管理する必要がある
- **柔軟性**: インスタンスタイプ、ストレージ、ネットワークをカスタマイズ可能
- **コスト**: インスタンス料金が発生

#### 適用シーン
- **大規模なワークロード**: 大規模なワークロード
- **カスタマイズが必要**: カスタマイズが必要な場合
- **コスト最適化**: コスト最適化が必要な場合

---

### 2. Fargate起動タイプ

#### 概要
Fargate起動タイプは、サーバーレスでコンテナを実行します。

#### 特徴
- **サーバーレス**: サーバーを管理する必要がない
- **自動スケーリング**: 自動的にスケーリング
- **料金**: タスクごとに課金

#### 適用シーン
- **小規模から中規模**: 小規模から中規模のワークロード
- **シンプルな運用**: シンプルな運用を望む場合
- **迅速なデプロイ**: 迅速なデプロイが必要な場合

---

## ECSのネットワークモード

### 1. awsvpcモード

#### 概要
awsvpcモードは、各タスクに独自のENI（Elastic Network Interface）を割り当てます。

#### 特徴
- **独自のIP**: 各タスクに独自のIPアドレスが割り当てられる
- **セキュリティグループ**: タスクごとにセキュリティグループを設定可能
- **VPC統合**: VPC内のリソースに直接アクセス可能

#### 適用シーン
- **Fargate**: Fargate起動タイプでは必須
- **セキュリティ**: タスクごとにセキュリティグループを設定したい場合

---

### 2. bridgeモード

#### 概要
bridgeモードは、Dockerのデフォルトのネットワークモードです。

#### 特徴
- **共有IP**: ホストのIPアドレスを共有
- **ポートマッピング**: ポートマッピングを使用
- **制限**: セキュリティグループの設定が制限される

#### 適用シーン
- **EC2起動タイプ**: EC2起動タイプでのみ使用可能
- **レガシーアプリケーション**: レガシーアプリケーションとの互換性が必要な場合

---

### 3. hostモード

#### 概要
hostモードは、タスクがホストのネットワークスタックを直接使用します。

#### 特徴
- **ホストネットワーク**: ホストのネットワークスタックを使用
- **パフォーマンス**: 高いパフォーマンス
- **制限**: セキュリティグループの設定が制限される

#### 適用シーン
- **EC2起動タイプ**: EC2起動タイプでのみ使用可能
- **高パフォーマンス**: 高パフォーマンスが必要な場合

---

## ECSのスケーリング

### 1. サービスのスケーリング

#### 手動スケーリング
- **タスク数の設定**: サービスのタスク数を手動で設定
- **シンプル**: シンプルな構成

#### 自動スケーリング
- **ターゲット追跡**: CloudWatchメトリクスに基づいて自動スケーリング
- **ステップスケーリング**: 閾値に基づいてステップスケーリング
- **スケジュールスケーリング**: スケジュールに基づいてスケーリング

---

### 2. クラスターのスケーリング

#### EC2起動タイプ
- **Auto Scaling**: EC2 Auto Scalingを使用してクラスターをスケーリング
- **容量プロバイダー**: 容量プロバイダーを使用して自動スケーリング

#### Fargate起動タイプ
- **自動スケーリング**: タスクのスケーリングに応じて自動的にスケーリング

---

## ECSのベストプラクティス

### 1. タスク定義の設計

#### 推奨事項
- **リソース制限**: CPUとメモリの制限を適切に設定
- **環境変数**: 機密情報はSecrets Managerを使用
- **ログドライバー**: CloudWatch Logsを使用してログを記録

---

### 2. サービスの設計

#### 推奨事項
- **複数のAZ**: 複数の可用性ゾーンにタスクを配置
- **ヘルスチェック**: ヘルスチェックを適切に設定
- **デプロイメント設定**: Blue/Greenデプロイメントを検討

---

### 3. セキュリティの設定

#### 推奨事項
- **タスクロール**: 最小権限の原則に従ってタスクロールを設定
- **セキュリティグループ**: 必要最小限のアクセス権限を設定
- **ネットワーク**: プライベートサブネットにタスクを配置

---

## 参考資料

- [AWS ECS公式ドキュメント](https://docs.aws.amazon.com/ecs/)
- [AWS ECSベストプラクティス](https://docs.aws.amazon.com/AmazonECS/latest/bestpracticesguide/)
- [AWS Fargate公式ドキュメント](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/AWS_Fargate.html)

