# AWS EC2（Elastic Compute Cloud）について

## 概要

EC2（Elastic Compute Cloud）は、AWSのクラウド内でスケーラブルなコンピューティング容量を提供するサービスです。EC2を使用することで、仮想サーバー（インスタンス）を起動し、アプリケーションを実行できます。

## EC2の主な特徴

### 1. 柔軟性

#### インスタンスタイプの選択
- **多様なインスタンスタイプ**: 用途に応じて最適なインスタンスタイプを選択
- **インスタンスサイズ**: 小規模から大規模まで様々なサイズを提供
- **動的な変更**: インスタンスタイプを動的に変更可能（停止後）

---

### 2. スケーラビリティ

#### 自動スケーリング
- **Auto Scaling**: 需要に応じて自動的にスケーリング
- **Elastic Load Balancing**: トラフィックを複数のインスタンスに分散
- **オンデマンド**: 必要な時に必要な分だけ起動

---

### 3. 料金モデル

#### 料金オプション
- **オンデマンド**: 使用した分だけ支払う従量課金
- **Reserved Instances**: 1年または3年のコミットメントで割引
- **Saving Plans**: 使用量ベースのコミットメントで割引
- **Spot Instances**: 未使用容量を利用して最大90%の割引

---

## EC2インスタンスタイプ

### 1. 汎用インスタンス（M）

#### 特徴
- **バランス**: CPU、メモリ、ネットワークのバランスが取れている
- **用途**: Webサーバー、アプリケーションサーバー、開発環境など

#### インスタンスファミリー
- **M5/M5a/M5n**: 汎用インスタンス（最新世代）
- **M4**: 汎用インスタンス（前世代）

---

### 2. コンピューティング最適化インスタンス（C）

#### 特徴
- **高CPU**: CPUパフォーマンスが高い
- **用途**: バッチ処理、ゲームサーバー、科学計算など

#### インスタンスファミリー
- **C5/C5a/C5n**: コンピューティング最適化インスタンス（最新世代）
- **C4**: コンピューティング最適化インスタンス（前世代）

---

### 3. メモリ最適化インスタンス（R）

#### 特徴
- **高メモリ**: メモリ容量が大きい
- **用途**: データベース、メモリキャッシュ、ビッグデータ分析など

#### インスタンスファミリー
- **R5/R5a/R5n**: メモリ最適化インスタンス（最新世代）
- **R4**: メモリ最適化インスタンス（前世代）

---

### 4. ストレージ最適化インスタンス（I、D）

#### 特徴
- **高ストレージ**: ストレージ容量とIOPSが高い
- **用途**: データウェアハウス、NoSQLデータベース、ビッグデータ分析など

#### インスタンスファミリー
- **I3/I3en**: ストレージ最適化インスタンス
- **D2**: 高密度ストレージインスタンス

---

### 5. アクセラレーテッドコンピューティングインスタンス（P、G、F）

#### 特徴
- **GPU/FPGA**: GPUやFPGAを搭載
- **用途**: 機械学習、画像処理、動画エンコードなど

#### インスタンスファミリー
- **P3/P4**: GPUインスタンス
- **G4**: GPUインスタンス（グラフィックス最適化）
- **F1**: FPGAインスタンス

---

## EC2インスタンスの構成要素

### 1. AMI（Amazon Machine Image）

#### 概要
AMIは、EC2インスタンスを起動するために必要な情報を含むテンプレートです。

#### AMIの種類
- **AWS提供AMI**: AWSが提供するAMI（Amazon Linux、Ubuntu、Windowsなど）
- **コミュニティAMI**: コミュニティが提供するAMI
- **カスタムAMI**: 自分で作成したAMI

#### AMIの選択
- **OS**: オペレーティングシステムを選択
- **アーキテクチャ**: x86_64、ARM64など
- **リージョン**: リージョンごとにAMIが異なる

---

### 2. インスタンスストア

#### 概要
インスタンスストアは、EC2インスタンスに物理的に接続された一時的なストレージです。

#### 特徴
- **一時的**: インスタンスが停止または終了するとデータが失われる
- **高性能**: EBSボリュームよりも高いパフォーマンス
- **無料**: インスタンス料金に含まれる

#### 用途
- **一時的なデータ**: キャッシュ、一時ファイルなど
- **高パフォーマンス**: 高パフォーマンスが必要なワークロード

---

### 3. EBSボリューム

#### 概要
EBSボリュームは、EC2インスタンスに接続できる永続的なブロックストレージです。

#### 特徴
- **永続的**: インスタンスが停止してもデータが保持される
- **スナップショット**: スナップショットを作成してバックアップ可能
- **暗号化**: 暗号化を有効化可能

#### ボリュームタイプ
- **gp3/gp2**: 汎用SSD
- **io1/io2**: プロビジョンドIOPS SSD
- **st1**: スループット最適化HDD
- **sc1**: コールドHDD

---

### 4. セキュリティグループ

#### 概要
セキュリティグループは、EC2インスタンスへのトラフィックを制御する仮想ファイアウォールです。

#### 特徴
- **ステートフル**: インバウンドを許可すると、対応するアウトバウンドが自動的に許可される
- **インスタンスレベル**: インスタンスごとにセキュリティグループを設定
- **複数のセキュリティグループ**: 1つのインスタンスに複数のセキュリティグループを適用可能

---

### 5. Elastic IP

#### 概要
Elastic IPは、動的に割り当てられるパブリックIPアドレスです。

#### 特徴
- **静的IP**: インスタンスを停止・起動してもIPアドレスが変わらない
- **再割り当て**: 別のインスタンスに再割り当て可能
- **料金**: 使用していないElastic IPには料金が発生

---

## EC2インスタンスのライフサイクル

### 1. インスタンスの状態

#### 起動中（Pending）
- **状態**: インスタンスが起動している
- **アクション**: インスタンスの準備が完了するまで待機

#### 実行中（Running）
- **状態**: インスタンスが実行中
- **アクション**: アプリケーションを実行可能

#### 停止中（Stopping）
- **状態**: インスタンスが停止している
- **アクション**: インスタンスの停止処理中

#### 停止済み（Stopped）
- **状態**: インスタンスが停止済み
- **アクション**: インスタンスを再起動可能

#### 終了中（Terminating）
- **状態**: インスタンスが終了している
- **アクション**: インスタンスの終了処理中

#### 終了済み（Terminated）
- **状態**: インスタンスが終了済み
- **アクション**: インスタンスは削除される

---

### 2. インスタンスの停止と終了

#### 停止（Stop）
- **データ保持**: EBSボリュームのデータは保持される
- **再起動可能**: インスタンスを再起動可能
- **料金**: インスタンス料金は発生しない（EBSボリューム料金は発生）

#### 終了（Terminate）
- **データ削除**: インスタンスストアのデータは削除される
- **EBSボリューム**: デフォルトでEBSボリュームも削除される（設定可能）
- **再起動不可**: インスタンスは再起動不可

---

## EC2のベストプラクティス

### 1. インスタンスタイプの選択

#### 推奨事項
- **ワークロード**: ワークロードの特性に応じてインスタンスタイプを選択
- **Right Sizing**: 適切なサイズのインスタンスを選択
- **コスト最適化**: コストとパフォーマンスのバランスを考慮

---

### 2. 高可用性の設計

#### 推奨事項
- **複数のAZ**: 複数の可用性ゾーンにインスタンスを配置
- **Auto Scaling**: Auto Scalingを使用して自動的にスケーリング
- **Elastic Load Balancing**: ELBを使用してトラフィックを分散

---

### 3. セキュリティの設定

#### 推奨事項
- **セキュリティグループ**: 必要最小限のアクセス権限を設定
- **IAMロール**: IAMロールを使用してインスタンスに権限を付与
- **暗号化**: EBSボリュームを暗号化

---

### 4. コスト最適化

#### 推奨事項
- **Reserved Instances**: 長期運用にはReserved Instancesを検討
- **Saving Plans**: 柔軟性が必要な場合はSaving Plansを検討
- **Spot Instances**: 中断可能なワークロードにはSpot Instancesを検討
- **未使用インスタンス**: 未使用のインスタンスを停止または終了

---

## 参考資料

- [AWS EC2公式ドキュメント](https://docs.aws.amazon.com/ec2/)
- [AWS EC2インスタンスタイプ](https://aws.amazon.com/ec2/instance-types/)
- [AWS EC2ベストプラクティス](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-best-practices.html)

