# AWS コスト最適化の概要

## はじめに

AWSのコスト最適化は、クラウド運用における重要な要素の一つです。適切な料金モデルを選択し、リソースの使用状況を監視・管理することで、コストを大幅に削減できます。

## 主要なコスト最適化手法

### 1. オンデマンド（On-Demand）

#### 概要
使用した分だけ支払う従量課金モデルです。事前のコミットメントは不要で、最も柔軟性が高い料金モデルです。

#### 特徴
- **柔軟性**: いつでも開始・停止が可能
- **予測可能性**: 事前のコミットメント不要
- **コスト**: 最も高い料金（基準となる料金）
- **適用範囲**: すべてのAWSサービス

#### 適用シーン
- 短期間のワークロード
- 予測不可能な使用パターン
- テスト・開発環境
- トラフィックが不安定なアプリケーション

---

### 2. Reserved Instances（RI）

#### 概要
特定のインスタンスタイプ、リージョン、可用性ゾーンに対して1年または3年のコミットメントを行うことで、オンデマンド料金と比較して最大75%の割引を受けることができます。

#### 特徴
- **割引率**: 最大75%の割引（3年契約、全額前払いの場合）
- **柔軟性**: 低い（特定のインスタンスタイプ、リージョン、AZに固定）
- **コミットメント**: インスタンス単位でのコミットメント
- **適用範囲**: EC2、RDS、ElastiCache、Redshift、DynamoDBなど

#### 種類
1. **Standard Reserved Instances**
   - 最大75%の割引
   - インスタンスタイプ、リージョン、AZが固定
   - 容量予約なし

2. **Convertible Reserved Instances**
   - 最大54%の割引
   - インスタンスファミリー内で変更可能
   - より柔軟だが割引率は低め

3. **Scheduled Reserved Instances**
   - 特定の時間帯に使用するワークロード向け
   - 週次または月次のスケジュールで使用

#### 支払いオプション
- 全額前払い（All Upfront）
- 部分前払い（Partial Upfront）
- 前払いなし（No Upfront）

#### 制約事項
- インスタンスタイプ、リージョン、AZが固定（Convertible RIを除く）
- 変更には制限がある
- 未使用分は失われる可能性がある

---

### 3. Saving Plans

#### 概要
一定の使用量（1時間あたりの料金）を1年または3年の期間でコミットメントすることで、オンデマンド料金と比較して最大72%の割引を受けることができます。Reserved Instancesよりも柔軟性が高い料金モデルです。

#### 特徴
- **割引率**: 最大72%の割引（3年契約、全額前払いの場合）
- **柔軟性**: Reserved Instancesよりも高い
- **コミットメント**: 使用量（$ per hour）ベースのコミットメント
- **適用範囲**: EC2、Lambda、Fargate、SageMakerなど

#### 種類
1. **Compute Saving Plan**
   - 最も柔軟性が高い
   - EC2、Lambda、Fargateなど複数サービスに適用可能
   - インスタンスタイプやリージョンの変更が容易

2. **EC2 Instance Saving Plan**
   - EC2専用
   - 特定のインスタンスファミリーとリージョンにコミットメント
   - Compute Saving Planよりも割引率が高い場合がある

3. **SageMaker AI Saving Plan**
   - SageMaker専用
   - MLワークロードに最適化

#### 支払いオプション
- 全額前払い（All Upfront）
- 部分前払い（Partial Upfront）
- 前払いなし（No Upfront）

---

## Saving Plans vs Reserved Instances

### 主な違い

| 項目 | Reserved Instances | Saving Plans |
|------|-------------------|--------------|
| **コミットメント単位** | インスタンス単位 | 使用量（$ per hour）単位 |
| **柔軟性** | 低い（特定のインスタンスタイプ、リージョン、AZに固定） | 高い（インスタンスタイプやリージョンの変更が可能） |
| **適用サービス** | EC2、RDS、ElastiCache、Redshift、DynamoDBなど | EC2、Lambda、Fargate、SageMakerなど |
| **割引率** | 最大75% | 最大72% |
| **インスタンスタイプ変更** | Standard RI: 不可、Convertible RI: ファミリー内のみ | 可能（Compute Saving Planの場合） |
| **リージョン変更** | 不可 | 可能（Compute Saving Planの場合） |
| **複数サービスへの適用** | 不可（サービスごとに購入が必要） | 可能（Compute Saving Planの場合） |
| **推奨用途** | 安定したワークロード、特定のインスタンスタイプで長期運用 | 柔軟性が必要、複数サービスを使用、インスタンスタイプを変更する可能性がある |

### 選択の指針

#### Reserved Instancesを選ぶべき場合
- 特定のインスタンスタイプ、リージョン、AZで長期運用する予定がある
- 最大限の割引率を求めている（75%の割引が必要）
- ワークロードが安定しており、変更の可能性が低い
- RDS、ElastiCache、Redshiftなど、Saving Plansが適用されないサービスを使用している

#### Saving Plansを選ぶべき場合
- インスタンスタイプやリージョンを変更する可能性がある
- 複数のコンピューティングサービス（EC2、Lambda、Fargate）を使用している
- 柔軟性を重視したい
- 使用量は予測できるが、具体的なインスタンスタイプは未確定

---

## その他のコスト最適化手法

### 4. Spot Instances

#### 概要
AWSの未使用容量を利用できるインスタンスで、最大90%の割引が可能です。ただし、AWSが必要に応じて中断する可能性があります。

#### 特徴
- **割引率**: 最大90%の割引
- **中断リスク**: AWSが必要に応じて中断する可能性がある
- **適用シーン**: 中断可能なワークロード（バッチ処理、ビッグデータ分析など）

### 5. 容量予約（Capacity Reservations）

#### 概要
特定のAZで容量を予約し、必要な時に確実にインスタンスを起動できるようにします。料金の割引はありませんが、容量の保証が得られます。

#### 特徴
- **容量保証**: 特定のAZで容量が保証される
- **料金**: 割引なし（オンデマンド料金）
- **適用シーン**: 特定のAZで確実にインスタンスを起動する必要がある場合

### 6. 専用ホスト（Dedicated Hosts）

#### 概要
物理サーバー全体を専有できるサービスです。ライセンス要件やコンプライアンス要件がある場合に適しています。

#### 特徴
- **専有性**: 物理サーバー全体を専有
- **ライセンス**: 既存のライセンスを使用可能
- **コスト**: 通常のインスタンスよりも高額
- **適用シーン**: ライセンス要件、コンプライアンス要件がある場合

---

## コスト最適化のベストプラクティス

### 1. 使用状況の分析
- AWS Cost Explorerを使用して使用状況を分析
- 使用パターンを把握し、適切な料金モデルを選択

### 2. 段階的なアプローチ
- まずはSaving Plansから始める（柔軟性が高いため）
- ワークロードが安定してきたら、Reserved Instancesを検討

### 3. 適切なサイジング
- 不要なリソースを削除
- 適切なインスタンスタイプを選択（過剰なスペックを避ける）

### 4. 自動スケーリング
- Auto Scalingを使用して需要に応じてリソースを調整
- 不要な時間帯にリソースを停止

### 5. タグ付けとコスト配分
- リソースにタグを付けてコストを追跡
- 部門やプロジェクトごとにコストを管理

### 6. 定期的な見直し
- 定期的に使用状況を確認
- 未使用のReserved InstancesやSaving Plansを売却または変更

---

## 料金モデルの比較まとめ

| 料金モデル | 割引率 | 柔軟性 | 中断リスク | 適用シーン |
|-----------|--------|--------|-----------|-----------|
| **オンデマンド** | 0% | 最高 | なし | 短期・予測不可能なワークロード |
| **Reserved Instances** | 最大75% | 低い | なし | 安定した長期ワークロード |
| **Saving Plans** | 最大72% | 高い | なし | 柔軟性が必要な長期ワークロード |
| **Spot Instances** | 最大90% | 中 | あり | 中断可能なワークロード |

---

## 参考資料

- [AWS Cost Management](https://aws.amazon.com/aws-cost-management/)
- [AWS Saving Plans](https://aws.amazon.com/savingsplans/)
- [AWS Reserved Instances](https://aws.amazon.com/ec2/pricing/reserved-instances/)
- [AWS Cost Explorer](https://aws.amazon.com/aws-cost-management/aws-cost-explorer/)

