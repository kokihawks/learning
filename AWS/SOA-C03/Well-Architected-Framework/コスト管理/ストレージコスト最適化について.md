# AWS ストレージコスト最適化について

## 概要

AWSのストレージコスト最適化は、適切なストレージクラスを選択し、ライフサイクルポリシーを設定することで、ストレージコストを大幅に削減できます。S3、EBS、EFSなど、各ストレージサービスの特性に応じて最適化を行います。

## S3ストレージコスト最適化

### 1. S3ストレージクラス

#### Standard
- **用途**: 頻繁にアクセスするデータ
- **可用性**: 99.99%
- **コスト**: 最も高い
- **適用シーン**: 本番環境のデータ、頻繁にアクセスするデータ

#### Standard-IA（Infrequent Access）
- **用途**: まれにアクセスするデータ
- **可用性**: 99.9%
- **コスト**: Standardの約50%
- **最小保存期間**: 30日
- **適用シーン**: バックアップ、ログファイル、アーカイブデータ

#### One Zone-IA
- **用途**: まれにアクセスするデータ（単一AZ）
- **可用性**: 99.5%
- **コスト**: Standard-IAの約20%安
- **最小保存期間**: 30日
- **適用シーン**: 再現可能なデータ、セカンダリバックアップ

#### Intelligent-Tiering
- **用途**: アクセスパターンが不明なデータ
- **可用性**: 99.99%
- **コスト**: 自動的に最適なストレージクラスに移動
- **適用シーン**: アクセスパターンが不明なデータ

#### Glacier Instant Retrieval
- **用途**: まれにアクセスするアーカイブデータ（即座に取得可能）
- **取得時間**: 数秒
- **コスト**: Standard-IAとGlacier Flexible Retrievalの中間
- **適用シーン**: まれにアクセスするが、即座に取得が必要なデータ

#### Glacier Flexible Retrieval
- **用途**: まれにアクセスするアーカイブデータ
- **取得時間**: 数分から数時間
- **コスト**: Standardの約20%
- **適用シーン**: バックアップ、アーカイブ、コンプライアンスデータ

#### Glacier Deep Archive
- **用途**: ほとんどアクセスしないアーカイブデータ
- **取得時間**: 12時間
- **コスト**: Standardの約5%
- **適用シーン**: 長期アーカイブ、コンプライアンスデータ

---

### 2. S3ライフサイクルポリシー

#### ライフサイクルポリシーの概要
- **自動移行**: データを自動的に適切なストレージクラスに移行
- **コスト削減**: アクセス頻度に応じてコストを削減
- **設定**: バケットまたはオブジェクトレベルで設定

#### 移行ルールの例
- **30日後**: Standard → Standard-IA
- **90日後**: Standard-IA → Glacier Flexible Retrieval
- **180日後**: Glacier Flexible Retrieval → Glacier Deep Archive

#### 有効期限ルール
- **自動削除**: 一定期間後に自動的に削除
- **コスト削減**: 不要なデータを自動的に削除
- **設定**: バケットまたはオブジェクトレベルで設定

---

### 3. S3コスト最適化のベストプラクティス

#### 1. 適切なストレージクラスの選択
- **アクセス頻度**: アクセス頻度に応じてストレージクラスを選択
- **可用性要件**: 可用性要件に応じてストレージクラスを選択
- **コスト**: コストとパフォーマンスのバランスを考慮

#### 2. ライフサイクルポリシーの設定
- **自動移行**: ライフサイクルポリシーで自動移行を設定
- **有効期限**: 不要なデータの有効期限を設定
- **定期的な見直し**: ライフサイクルポリシーを定期的に見直し

#### 3. データの圧縮
- **圧縮**: データを圧縮してストレージコストを削減
- **フォーマット**: 圧縮効率の高いフォーマットを使用
- **コスト削減**: ストレージコストを削減

#### 4. 重複データの削除
- **重複の検出**: 重複データを検出
- **重複の削除**: 重複データを削除
- **コスト削減**: ストレージコストを削減

---

## EBSストレージコスト最適化

### 1. EBSボリュームタイプ

#### gp3（General Purpose SSD）
- **用途**: 汎用的なワークロード
- **パフォーマンス**: 3,000 IOPS（ベースライン）、最大16,000 IOPS
- **スループット**: 125 MB/s（ベースライン）、最大1,000 MB/s
- **コスト**: gp2より約20%安
- **適用シーン**: 汎用的なワークロード、ブートボリューム

#### gp2（General Purpose SSD）
- **用途**: 汎用的なワークロード
- **パフォーマンス**: ボリュームサイズに比例（3 IOPS/GB）
- **スループット**: ボリュームサイズに比例
- **コスト**: gp3より高い
- **適用シーン**: 汎用的なワークロード（gp3への移行を推奨）

#### io1/io2（Provisioned IOPS SSD）
- **用途**: 高パフォーマンスが必要なワークロード
- **パフォーマンス**: 最大64,000 IOPS（io2 Block Express）
- **スループット**: 最大4,000 MB/s
- **コスト**: 最も高い
- **適用シーン**: データベース、高パフォーマンスが必要なワークロード

#### st1（Throughput Optimized HDD）
- **用途**: スループット重視のワークロード
- **パフォーマンス**: 500 IOPS（ベースライン）
- **スループット**: 最大500 MB/s
- **コスト**: SSDより安
- **適用シーン**: ビッグデータ、データウェアハウス、ログ処理

#### sc1（Cold HDD）
- **用途**: コールドデータ
- **パフォーマンス**: 250 IOPS（ベースライン）
- **スループット**: 最大250 MB/s
- **コスト**: 最も安
- **適用シーン**: コールドデータ、アーカイブ

---

### 2. EBSコスト最適化のベストプラクティス

#### 1. 適切なボリュームタイプの選択
- **ワークロード**: ワークロードに応じてボリュームタイプを選択
- **パフォーマンス要件**: パフォーマンス要件に応じてボリュームタイプを選択
- **コスト**: コストとパフォーマンスのバランスを考慮

#### 2. ボリュームサイズの最適化
- **Right Sizing**: 適切なボリュームサイズを選択
- **未使用領域**: 未使用領域を削減
- **コスト削減**: ストレージコストを削減

#### 3. スナップショットの管理
- **スナップショットの削除**: 不要なスナップショットを削除
- **スナップショットのライフサイクル**: スナップショットのライフサイクルを管理
- **コスト削減**: スナップショットのコストを削減

#### 4. gp2からgp3への移行
- **コスト削減**: gp3への移行でコストを削減
- **パフォーマンス**: パフォーマンス要件に応じてIOPSとスループットを調整
- **移行**: 簡単に移行可能

---

## EFSストレージコスト最適化

### 1. EFSストレージクラス

#### Standard
- **用途**: 頻繁にアクセスするデータ
- **可用性**: 99.99%
- **コスト**: 最も高い
- **適用シーン**: 本番環境のデータ、頻繁にアクセスするデータ

#### Standard-IA
- **用途**: まれにアクセスするデータ
- **可用性**: 99.9%
- **コスト**: Standardの約50%
- **適用シーン**: バックアップ、ログファイル、アーカイブデータ

---

### 2. EFSパフォーマンスモード

#### General Purpose
- **用途**: 汎用的なワークロード
- **レイテンシ**: 低レイテンシ
- **適用シーン**: 汎用的なワークロード、Webサーバー、コンテンツ管理

#### Max I/O
- **用途**: 高スループットが必要なワークロード
- **レイテンシ**: やや高いレイテンシ
- **適用シーン**: ビッグデータ、データウェアハウス、分析ワークロード

---

### 3. EFSスループットモード

#### Bursting
- **用途**: バーストパターンのワークロード
- **スループット**: ファイルシステムサイズに比例
- **適用シーン**: バーストパターンのワークロード

#### Provisioned
- **用途**: 一定のスループットが必要なワークロード
- **スループット**: プロビジョニングされたスループット
- **適用シーン**: 一定のスループットが必要なワークロード

---

### 4. EFSコスト最適化のベストプラクティス

#### 1. 適切なストレージクラスの選択
- **アクセス頻度**: アクセス頻度に応じてストレージクラスを選択
- **ライフサイクルポリシー**: ライフサイクルポリシーで自動移行を設定
- **コスト削減**: ストレージコストを削減

#### 2. パフォーマンスモードの選択
- **ワークロード**: ワークロードに応じてパフォーマンスモードを選択
- **レイテンシ**: レイテンシ要件に応じてパフォーマンスモードを選択
- **コスト**: コストとパフォーマンスのバランスを考慮

#### 3. スループットモードの選択
- **ワークロード**: ワークロードに応じてスループットモードを選択
- **スループット要件**: スループット要件に応じてスループットモードを選択
- **コスト**: コストとパフォーマンスのバランスを考慮

---

## ストレージコスト最適化の共通ベストプラクティス

### 1. データの分類

#### データの分類
- **ホットデータ**: 頻繁にアクセスするデータ
- **ウォームデータ**: 定期的にアクセスするデータ
- **コールドデータ**: まれにアクセスするデータ
- **アーカイブデータ**: ほとんどアクセスしないデータ

#### 分類の重要性
- **適切なストレージクラス**: データの分類に応じて適切なストレージクラスを選択
- **コスト削減**: データの分類に応じてコストを削減
- **パフォーマンス**: データの分類に応じてパフォーマンスを最適化

---

### 2. ライフサイクルポリシーの設定

#### ライフサイクルポリシーの重要性
- **自動移行**: データを自動的に適切なストレージクラスに移行
- **コスト削減**: アクセス頻度に応じてコストを削減
- **管理の簡素化**: 手動での管理を簡素化

#### ライフサイクルポリシーの設定
- **移行ルール**: データの移行ルールを設定
- **有効期限ルール**: データの有効期限ルールを設定
- **定期的な見直し**: ライフサイクルポリシーを定期的に見直し

---

### 3. データの圧縮と重複排除

#### データの圧縮
- **圧縮**: データを圧縮してストレージコストを削減
- **フォーマット**: 圧縮効率の高いフォーマットを使用
- **コスト削減**: ストレージコストを削減

#### 重複排除
- **重複の検出**: 重複データを検出
- **重複の削除**: 重複データを削除
- **コスト削減**: ストレージコストを削減

---

### 4. 定期的な見直し

#### 見直しの重要性
- **使用状況の変化**: 使用状況が変化する可能性がある
- **新しいストレージクラス**: 新しいストレージクラスが追加される可能性がある
- **最適化の機会**: 新しい最適化の機会が生まれる可能性がある

#### 見直しの頻度
- **四半期ごと**: 四半期ごとに見直し
- **重要な変更後**: 重要な変更後に見直し
- **コスト増加時**: コストが増加した場合に見直し

---

## 参考資料

- [AWS S3ストレージクラス公式ドキュメント](https://aws.amazon.com/s3/storage-classes/)
- [AWS EBSボリュームタイプ公式ドキュメント](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-volume-types.html)
- [AWS EFS公式ドキュメント](https://aws.amazon.com/efs/)
- [AWS S3ライフサイクルポリシー公式ドキュメント](https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lifecycle-mgmt.html)

