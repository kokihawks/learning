# DDDについて

## DDD(Domain-Driven Design、ドメイン駆動設計)とは

DDDはソフトウェア設計手法の一つで、ビジネスドメインを中心にモデルを設計するアプローチです。

### ソフトウェア設計手法とは

ソフトウェア設計手法とは、ソフトウェアシステムを効率的かつ保守可能に構築するための方法論やアプローチのことを指します。以下のような特徴があります:

- **構造化されたアプローチ**: コードの書き方、システムの構造化、組織の方法についての指針を提供する
- **問題解決のパターン**: よくある問題に対する解決策のパターンを提供し、開発の効率化と品質向上を図る
- **コミュニケーションの促進**: 開発チーム内で共通の考え方や用語を共有し、コミュニケーションを改善する

ソフトウェア設計手法には、DDD以外にも以下のようなものがあります:

- **オブジェクト指向設計（OOP）**: オブジェクトとクラスを中心に設計する
- **関数型プログラミング**: 関数を基本単位として設計する
- **マイクロサービスアーキテクチャ**: システムを小さなサービスに分割して設計する
- **レイヤードアーキテクチャ**: システムを層（レイヤー）に分けて設計する
- **MVC（Model-View-Controller）**: アプリケーションをモデル、ビュー、コントローラーの3つの要素に分けて設計する

DDDは、特に複雑なビジネスロジックを扱うシステムにおいて、ビジネスドメインを中心に据えることで、上記の手法とは異なるアプローチを提供します。

### なぜDDDが存在するのか

従来のソフトウェア開発では、以下のような問題が頻繁に発生していました:

- **ビジネス要件とコードの乖離**: 設計書や仕様書で定義されたビジネスロジックが、実際のコードに反映されず、時間が経つにつれて乖離が拡大する
- **ドメインエキスパートと開発者のコミュニケーション不足**: ビジネス側の専門知識が開発者に正確に伝わらず、誤った実装が行われる
- **技術中心の設計**: データベースの構造やフレームワークの都合に合わせて設計し、ビジネスロジックが複雑に散在する
- **複雑なビジネスルールの扱い**: ビジネスロジックが至る所に散らばり、変更時の影響範囲が分からず、バグが発生しやすい
- **長期的なメンテナンスの困難さ**: コードからビジネスの意図が読み取れず、修正や機能追加が困難になる

これらの問題を解決するため、DDDは「**ビジネスドメインを中心に据えた設計手法**」として生まれました。技術的な制約ではなく、ビジネスドメインの知識とルールをコードに直接反映させることで、以下のような効果をもたらします:

- ビジネスロジックが明確にコードに表現され、理解しやすくなる
- ドメインエキスパートと開発者が共通言語でコミュニケーションできる
- ビジネス要件の変更に対して柔軟に対応できる
- 長期的なメンテナンス性が向上する

特に、複雑なビジネスロジックを扱うシステム（金融、保険、Eコマース、予約管理など）において、DDDはその真価を発揮します。

### 概要

- ビジネスドメインを中心にモデルを設計する
- ドメインエキスパートと開発者が協力してモデルを構築する
- 複雑なビジネスロジックを扱うソフトウェア開発に適している

### DDDの主な特徴

1. **ドメインを重視**: ビジネスドメインがソフトウェアの中心となる
2. **ユビキタス言語**: ドメインエキスパートと開発者が共通言語を使用
3. **モデルと実装の一致**: ドメインモデルがコードに直接反映される
4. **複雑さの管理**: 大きなシステムを境界づけられたコンテキストに分割

## DDDの基本概念

### ビジネスドメインとは

ビジネスドメインとは、ソフトウェアが解決しようとしているビジネス領域や知識領域のことを指します。システムが扱う問題や業務の知識領域であり、以下のような具体例があります:

- **Eコマース**のドメイン: 商品、注文、決済、配送、在庫管理
- **金融**のドメイン: 口座、取引、利息計算、リスク評価
- **予約管理**のドメイン: 予約、利用者、施設、空き状況

DDDでは、このビジネスドメインの知識とルールがソフトウェア設計の中心となり、ドメインエキスパート（その領域の専門家）が持つ業務知識をコードに直接反映させます。

### ユビキタス言語とは

ユビキタス言語（Ubiquitous Language）とは、ドメインエキスパートと開発者が共通して使用する言語のことを指します。DDDにおける重要な原則の一つで、以下の特徴があります:

- **共通の用語**: ビジネス側と開発側が同じ用語を使って会話し、ドキュメントやコードでも同じ言葉を使う
- **一貫性の確保**: ドメイン概念とコード上の名前が一致し、誤解を防ぐ
- **コミュニケーションの改善**: 技術的な専門用語ではなく、ビジネス領域の自然な言葉を使うことで理解が深まる

例えば、Eコマースシステムでは「注文（Order）」「カート（Cart）」「決済（Payment）」などの用語を、ビジネス関係者と開発者の間で同じ意味で使用し、コードでも同じ名前のクラスやメソッドとして実装します。これにより、コードを読むだけでビジネスの意図が理解できるようになります。

### ドメインエキスパートとは

ドメインエキスパート（Domain Expert）とは、特定のビジネスドメインにおける深い知識と経験を持つ専門家のことを指します。DDDでは、このドメインエキスパートと開発者が協力してモデルを構築することが重要です。以下のような特徴があります:

- **業務の専門知識**: そのビジネス領域のルール、業務フロー、制約を深く理解している
- **開発者との協働**: ドメインエキスパートの知識を開発者が理解しやすい形で伝え、一緒にモデルを作り上げる
- **知識の源泉**: システムが実装すべきビジネスロジックやルールを提供する役割を担う

例えば、Eコマースシステムでは、商品マネージャーや在庫管理の責任者がドメインエキスパートになることがあります。金融システムでは、金融商品の専門家やリスク管理の担当者が該当します。彼らの知識を正確にソフトウェアに反映させることで、ビジネス要件を満たすシステムを構築できます。

### モデルと実装の一致とは

モデルと実装の一致とは、ドメインモデル（ドメインエキスパートと開発者が協力して構築したビジネスの概念モデル）がコードに直接反映されることを指します。DDDにおける重要な原則の一つで、以下の特徴があります:

- **コードがドキュメント**: コード自体がビジネスの概念を表現しており、コードを読むことでドメインモデルが理解できる
- **ドキュメントとコードの乖離防止**: 設計書や仕様書とコードが一致しない問題を防ぐ
- **ビジネスロジックの明確化**: ドメインの概念やルールがコード内で明確に表現される

例えば、Eコマースシステムで「注文」という概念をモデル化した場合、コード内にも`Order`クラスとして実装されます。注文に関連するビジネスルール（例: 注文金額が10,000円以上の場合は送料無料）も、`Order`クラスのメソッドとして直接実装され、データベースのスキーマやテーブル設計ではなく、ドメインオブジェクトとして表現されます。これにより、ビジネスロジックが明確にコードに反映され、メンテナンスが容易になります。

### 複雑さの管理とは

複雑さの管理とは、大きなシステムを複数の**境界づけられたコンテキスト（Bounded Context）**に分割することで、システム全体の複雑さを管理するDDDの重要な原則です。以下の特徴があります:

- **境界づけられたコンテキスト**: 特定のドメインモデルが有効な明確な境界を持つ領域。各コンテキスト内でモデルと用語が一貫性を持つ
- **コンテキストマッピング**: 異なる境界づけられたコンテキスト間の関係性を定義し、連携方法を明確にする
- **独立性の確保**: 各コンテキストが独立して進化でき、他のコンテキストへの影響を最小限に抑える

例えば、大規模なEコマースシステムでは、「注文管理」「在庫管理」「配送管理」「決済処理」などのコンテキストに分割できます。各コンテキスト内では「注文」という概念が異なる意味を持つ可能性があります（注文管理では「顧客の注文」、在庫管理では「在庫引当の対象」など）。境界づけられたコンテキストにより、各領域のモデルを明確にし、システム全体の複雑さを管理しやすくなります。
